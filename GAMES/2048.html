<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2048 Super Runner</title>
    <style>
        :root {
            --sky: #87CEEB;
            --road: #34495e;
        }
        body { margin: 0; overflow: hidden; background: var(--sky); font-family: 'Arial Rounded MT Bold', Arial, sans-serif; touch-action: none; }
        
        #game-container { position: relative; width: 100vw; height: 100vh; perspective: 1000px; overflow: hidden; }

        /* Jalanan dengan efek gerak */
        #road {
            position: absolute;
            bottom: -500px; left: 50%;
            transform: translateX(-50%) rotateX(60deg);
            width: 450px; height: 3000px;
            background: linear-gradient(var(--road), #2c3e50);
            background-size: 100% 200px;
            border-left: 12px dashed gold; border-right: 12px dashed gold;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .cube {
            position: absolute;
            width: 80px; height: 80px;
            border-radius: 15px;
            display: flex; justify-content: center; align-items: center;
            font-size: 32px; font-weight: bold; color: white;
            box-shadow: 0 10px 0 rgba(0,0,0,0.3);
            text-shadow: 2px 2px 0px rgba(0,0,0,0.3);
            pointer-events: none;
            z-index: 5;
        }

        /* Warna Cerah */
        .v2 { background: #ff4d4d; } .v4 { background: #ff9f43; }
        .v8 { background: #feca57; } .v16 { background: #48dbfb; }
        .v32 { background: #ff9ff3; } .v64 { background: #54a0ff; }
        .v128 { background: #5f27cd; } .v256 { background: #1dd1a1; }

        #player {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transition: transform 0.05s linear;
            z-index: 10;
        }

        #ui {
            position: fixed; top: 20px; width: 100%; text-align: center;
            font-size: 50px; color: white; font-weight: 900;
            text-shadow: 4px 4px 0 #333; z-index: 100;
        }

        #start-screen {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            color: white; z-index: 1000; text-align: center;
        }

        button {
            padding: 25px 60px; font-size: 35px; border-radius: 60px; border: none;
            background: #2ecc71; color: white; cursor: pointer; 
            box-shadow: 0 12px 0 #27ae60; transition: 0.1s;
        }
        
        button:active { transform: translateY(8px); box-shadow: 0 4px 0 #27ae60; }

        .particle { position: absolute; width: 12px; height: 12px; border-radius: 50%; pointer-events: none; z-index: 100; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1 style="font-size: 60px; margin-bottom: 10px;">2048 RUNNER</h1>
    <p style="font-size: 20px; margin-bottom: 30px;">Tabrak angka yang SAMA!</p>
    <button onclick="startGame()">MAIN SEKARANG! ðŸš€</button>
</div>

<div id="game-container">
    <div id="ui"><span id="score">0</span></div>
    <div id="road"></div>
    <div id="player" class="cube v2">2</div>
</div>

<script>
    const player = document.getElementById('player');
    const scoreText = document.getElementById('score');
    const container = document.getElementById('game-container');
    
    let score = 0;
    let playerVal = 2;
    let playerX = 0;
    let obstacles = [];
    let gameActive = false;
    let speed = 7;
    let audioCtx;

    // Fungsi Suara (Web Audio API)
    function initAudio() {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }

    function playNote(freq, type, dur) {
        if(!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + dur);
    }

    function startGame() {
        initAudio();
        document.getElementById('start-screen').style.display = 'none';
        gameActive = true;
        score = 0;
        playerVal = 2;
        updatePlayerVisual();
        
        // Mulai memunculkan angka rintangan
        spawnObstacle(); 
        update();
    }

    // Input Control (Mouse & Touch)
    const moveControl = (e) => {
        if(!gameActive) return;
        let xPos = e.touches ? e.touches[0].clientX : e.clientX;
        // Konversi koordinat layar ke posisi lintasan
        playerX = ((xPos / window.innerWidth) - 0.5) * 400;
        playerX = Math.max(-160, Math.min(160, playerX));
        updatePlayerVisual();
    };

    window.addEventListener('mousemove', moveControl);
    window.addEventListener('touchmove', moveControl);

    function updatePlayerVisual() {
        player.style.transform = `translateX(calc(-50% + ${playerX}px)) rotateY(${playerX/10}deg)`;
        player.innerHTML = playerVal;
        player.className = `cube v${playerVal}`;
    }

    function spawnObstacle() {
        if(!gameActive) return;

        const obs = document.createElement('div');
        // Angka rintangan bisa sama dengan player atau angka kecil lainnya
        const possibleValues = [2, 4, 8, playerVal];
        const val = possibleValues[Math.floor(Math.random() * possibleValues.length)];
        
        obs.className = `cube v${val}`;
        obs.innerHTML = val;
        
        // Tentukan jalur (5 jalur pilihan)
        let lanes = [-150, -75, 0, 75, 150];
        let xPos = lanes[Math.floor(Math.random() * lanes.length)];
        
        obs.style.left = `50%`;
        obs.style.top = "-100px";
        obs.style.transform = `translateX(calc(-50% + ${xPos}px))`;
        
        container.appendChild(obs);
        obstacles.push({ el: obs, y: -100, x: xPos, val: val });
        
        // Kecepatan spawn bertambah seiring skor
        let nextSpawn = Math.max(400, 1200 - (score * 2));
        setTimeout(spawnObstacle, nextSpawn);
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<10; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.backgroundColor = color;
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            document.body.appendChild(p);
            
            const angle = Math.random() * Math.PI * 2;
            const vel = Math.random() * 6 + 4;
            let posX = 0, posY = 0;
            
            const moveP = setInterval(() => {
                posX += Math.cos(angle) * vel;
                posY += Math.sin(angle) * vel;
                p.style.transform = `translate(${posX}px, ${posY}px)`;
                p.style.opacity = (p.style.opacity || 1) - 0.05;
                if(p.style.opacity <= 0) {
                    clearInterval(moveP);
                    p.remove();
                }
            }, 20);
        }
    }

    function update() {
        if(!gameActive) return;

        for (let i = obstacles.length - 1; i >= 0; i--) {
            let o = obstacles[i];
            o.y += speed;
            o.el.style.top = o.y + "px";

            // Deteksi Tabrakan
            let pRect = player.getBoundingClientRect();
            let oRect = o.el.getBoundingClientRect();

            // Cek jika kotak bersentuhan
            if (!(pRect.right < oRect.left || pRect.left > oRect.right || pRect.bottom < oRect.top || pRect.top > oRect.bottom)) {
                
                if (o.val === playerVal) {
                    // BERHASIL GABUNG
                    playerVal *= 2;
                    score += 10;
                    scoreText.innerHTML = score;
                    
                    playNote(400 + playerVal, 'triangle', 0.2);
                    createExplosion(oRect.left + 40, oRect.top + 40, '#fff');
                    
                    // Efek Pop
                    player.style.scale = "1.5";
                    setTimeout(() => player.style.scale = "1", 100);
                    
                    updatePlayerVisual();
                } else {
                    // TABRAK ANGKA BERBEDA
                    gameActive = false;
                    playNote(150, 'sawtooth', 0.6);
                    alert("YAAAH! Skor kamu: " + score + "\nTip: Tabrak angka yang sama ya!");
                    location.reload();
                }
                
                o.el.remove();
                obstacles.splice(i, 1);
                continue;
            }

            // Hapus jika sudah lewat bawah
            if (o.y > window.innerHeight) {
                o.el.remove();
                obstacles.splice(i, 1);
            }
        }
        
        requestAnimationFrame(update);
    }
</script>

</body>
</html>
